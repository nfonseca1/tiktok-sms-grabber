<html>
    <head>
        <title></title>
    </head>
    <body>
        <button>Get Videos</button>
        <br>
        <div class="content">
            
        </div>
        <script>
            let btn = document.querySelector("button");
            let content = document.querySelector(".content");

            btn.addEventListener("click", () => {
                fetch("/", {
                    method: 'POST'
                })
                .then(res => {
                    window.postIndex = 0;
                    let interval = setInterval((interval) => {
                        checkStatus(interval);
                    }, 5000);
                })
                
            })

            async function checkStatus(interval) {
                let response = await fetch("/status");
                let data = await response.json();
                if (data.posts.length === 0) return;
                for (let i = window.postIndex; i < data.posts.length; i++) {
                    let div = document.createElement("div");
                    div.innerHTML = data.posts[i].html;
                    let script = document.createElement("script");
                    let src = document.createAttribute("src");
                    src.value = "https://www.tiktok.com/embed.js";
                    script.setAttributeNode(src);
                    div.appendChild(script);
                    document.querySelector("body").appendChild(div);
                }
                window.postIndex = data.posts.length;
                if (data.completed) clearInterval(interval);
            }
        </script>
    </body>
</html>